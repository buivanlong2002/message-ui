<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>TomoTalk</title>
    <!-- S·ª≠ d·ª•ng phi√™n b·∫£n Bootstrap Icons m·ªõi h∆°n ƒë·ªÉ c√≥ nhi·ªÅu icon h∆°n -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
<div id="container">
    <!-- Sidebar -->
    <aside id="sidebar">
        <div id="sidebar-top">
            <i class="bi bi-list" id="menu-toggle"></i>
            <input type="text" id="search-box" placeholder="T√¨m ki·∫øm..."/>
        </div>

        <!-- Menu Sidebar (ƒê√É T√ÅI C·∫§U TR√öC) -->
        <nav id="sidebar-menu" class="menu-dropdown">
            <ul>
                <li data-section="profile"><i class="bi bi-person-circle"></i> Trang c√° nh√¢n</li>
                <li data-section="friends"><i class="bi bi-people-fill"></i> B·∫°n b√®</li>
                <li data-section="friend-requests"><i class="bi bi-person-plus-fill"></i> L·ªùi m·ªùi k·∫øt b·∫°n</li>
                <li data-section="security"><i class="bi bi-shield-lock-fill"></i> B·∫£o m·∫≠t</li>
                <li data-section="logout"><i class="bi bi-box-arrow-right"></i> ƒêƒÉng xu·∫•t</li>
            </ul>
        </nav>

        <div id="chat-list">
            <!-- Danh s√°ch c√°c cu·ªôc tr√≤ chuy·ªán s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
        </div>
    </aside>

    <!-- Main Chat Content -->
    <main id="chat-content">

        <div id="chat-header"></div>
        <div class="chat-and-profile">
            <!-- Chat Area -->
            <section id="chat-area" class="chat-area">
                <div id="chat-messages" class="chat-messages"></div>
                <div id="chat-input-container" class="chat-input-container"></div>
            </section>
            <!-- Chat Profile (cho t·ª´ng cu·ªôc tr√≤ chuy·ªán) -->
            <aside id="profile-content" class="profile-content" style="display: none;">
                <div class="profile-header">
                    <button id="profile-close" class="profile-close">√ó</button>
                    <h2>Th√¥ng tin cu·ªôc tr√≤ chuy·ªán</h2>
                </div>
                <ul>
                    <li data-action="search-messages"><i class="bi bi-search"></i> T√¨m ki·∫øm tin nh·∫Øn</li>
                    <li data-action="archived"><i class="bi bi-archive"></i> L∆∞u tr·ªØ</li>
                    <li data-action="photos"><i class="bi bi-image"></i> ·∫¢nh</li>
                    <li data-action="files"><i class="bi bi-file-earmark"></i> File</li>
                    <li data-action="links"><i class="bi bi-link"></i> Li√™n k·∫øt</li>
                    <li data-action="notifications"><i class="bi bi-bell"></i> Th√¥ng b√°o</li>
                </ul>
            </aside>
        </div>
    </main>

    <!-- Overlay Menu (Ch·ª©a c√°c section ch√≠nh) -->
    <div id="menu-content-overlay" class="menu-overlay" style="display: none;">
        <div class="menu-content">
            <button id="menu-close" class="menu-close">√ó</button>
            <div id="menu-section-content" class="menu-section-content">

                <!-- 1. Profile Section (ƒê√É L√ÄM ƒê·∫∏P L·∫†I) -->
                <section id="profile" class="menu-section">
                        <div class="cover-photo">
                            <img src="https://images.unsplash.com/photo-1504805572947-34fad45aed93?q=80&w=2070&auto=format&fit=crop" alt="·∫¢nh b√¨a" class="cover-img"/>
                        </div>
                        <div class="profile-info">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="·∫¢nh ƒë·∫°i di·ªán" class="avatar"/>
                            <h2 class="username">Nguy·ªÖn VƒÉn A</h2>
                            <p class="profile-bio">"Cu·ªôc s·ªëng l√† m·ªôt h√†nh tr√¨nh, kh√¥ng ph·∫£i l√† ƒë√≠ch ƒë·∫øn." üöÄ</p>
                            <div class="profile-actions">
                                <button id="edit-profile-btn" class="profile-btn primary"><i class="bi bi-pencil-square"></i> Ch·ªânh s·ª≠a trang c√° nh√¢n</button>
                            </div>
                        </div>
                </section>

                <!-- 2. Friends Section (ƒê√É T√ÅCH L·ªúI M·ªúI) -->
                <section id="friends" class="menu-section" style="display: none;">
                    <h2>Danh s√°ch b·∫°n b√®</h2>
                    <input type="text" id="friend-search" placeholder="T√¨m ki·∫øm b·∫°n b√®..." class="friend-search-box"/>
                    <div class="friends-list">
                        <!-- Danh s√°ch b·∫°n b√® s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        <div class="friend-item">
                            <img src="https://randomuser.me/api/portraits/women/45.jpg" alt="·∫¢nh b·∫°n b√®" class="friend-avatar"/>
                            <div class="friend-info">
                                <h3 class="friend-name">Tr·∫ßn Th·ªã B</h3>
                                <p class="friend-status">Online</p>
                            </div>
                            <div class="friend-actions">
                                <button class="friend-btn primary" data-action="message"><i class="bi bi-chat-fill"></i> Nh·∫Øn tin</button>
                                <button class="friend-btn" data-action="remove"><i class="bi bi-person-x-fill"></i> X√≥a</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 3. Friend Requests Section (M·ª§C M·ªöI) -->
                <section id="friend-requests" class="menu-section" style="display: none;">
                    <h2>L·ªùi m·ªùi k·∫øt b·∫°n</h2>
                    <div class="friend-requests-list">
                        <!-- L·ªùi m·ªùi k·∫øt b·∫°n s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        <div class="friend-item">
                            <img src="https://randomuser.me/api/portraits/women/23.jpg" alt="·∫¢nh ng∆∞·ªùi g·ª≠i" class="friend-avatar"/>
                            <div class="friend-info">
                                <h3 class="friend-name">Ph·∫°m Th·ªã D</h3>
                            </div>
                            <div class="friend-actions">
                                <button class="friend-btn primary" data-action="accept"><i class="bi bi-check-circle-fill"></i> Ch·∫•p nh·∫≠n</button>
                                <button class="friend-btn" data-action="decline"><i class="bi bi-x-circle-fill"></i> T·ª´ ch·ªëi</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 4. Security Section (ƒê√É HO√ÄN THI·ªÜN) -->
                <section id="security" class="menu-section" style="display: none;">
                    <h2>B·∫£o m·∫≠t & Quy·ªÅn ri√™ng t∆∞</h2>
                    <!-- Navigation Tabs -->
                    <div class="security-nav">
                        <button class="security-nav-item active" data-target="security-edit-info"><i class="bi bi-pencil-square"></i> Th√¥ng tin</button>
                        <button class="security-nav-item" data-target="security-change-password"><i class="bi bi-key-fill"></i> M·∫≠t kh·∫©u</button>
                        <button class="security-nav-item" data-target="security-blocked-users"><i class="bi bi-slash-circle-fill"></i> Qu·∫£n l√Ω ch·∫∑n</button>
                    </div>

                    <!-- Tab Content -->
                    <div class="security-content">
                        <!-- Tab 1: Edit Info View -->
                        <div id="security-edit-info" class="security-view active">
                            <h3>Ch·ªânh s·ª≠a th√¥ng tin c√° nh√¢n</h3>
                            <form class="security-form">
                                <div class="form-group">
                                    <label for="edit-avatar">·∫¢nh ƒë·∫°i di·ªán (URL)</label>
                                    <input type="text" id="edit-avatar" value="https://randomuser.me/api/portraits/men/32.jpg">
                                </div>
                                <div class="form-group">
                                    <label for="edit-cover">·∫¢nh b√¨a (URL)</label>
                                    <input type="text" id="edit-cover" value="https://images.unsplash.com/photo-1504805572947-34fad45aed93">
                                </div>
                                <div class="form-group">
                                    <label for="edit-username">T√™n ng∆∞·ªùi d√πng</label>
                                    <input type="text" id="edit-username" value="Nguy·ªÖn VƒÉn A">
                                </div>
                                <div class="form-group">
                                    <label for="edit-bio">Ti·ªÉu s·ª≠</label>
                                    <textarea id="edit-bio" rows="3">"Cu·ªôc s·ªëng l√† m·ªôt h√†nh tr√¨nh, kh√¥ng ph·∫£i l√† ƒë√≠ch ƒë·∫øn." üöÄ</textarea>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="profile-btn primary">L∆∞u thay ƒë·ªïi</button>
                                </div>
                            </form>
                        </div>
                        <!-- Tab 2: Change Password View -->
                        <div id="security-change-password" class="security-view" style="display: none;">
                            <h3>ƒê·ªïi m·∫≠t kh·∫©u</h3>
                            <form class="security-form">
                                <div class="form-group">
                                    <label for="current-password">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                                    <input type="password" id="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                </div>
                                <div class="form-group">
                                    <label for="new-password">M·∫≠t kh·∫©u m·ªõi</label>
                                    <input type="password" id="new-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                </div>
                                <div class="form-group">
                                    <label for="confirm-password">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                                    <input type="password" id="confirm-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="profile-btn primary">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u</button>
                                </div>
                            </form>
                        </div>
                        <!-- Tab 3: Blocked Users View -->
                        <div id="security-blocked-users" class="security-view" style="display: none;">
                            <h3>Danh s√°ch ng∆∞·ªùi d√πng b·ªã ch·∫∑n</h3>
                            <div class="blocked-users-list">
                                <div class="friend-item">
                                    <img src="https://randomuser.me/api/portraits/men/88.jpg" alt="·∫¢nh ng∆∞·ªùi b·ªã ch·∫∑n" class="friend-avatar"/>
                                    <div class="friend-info">
                                        <h3 class="friend-name">L√Ω Th·ªã E</h3>
                                    </div>
                                    <div class="friend-actions">
                                        <button class="friend-btn" data-action="unblock"><i class="bi bi-unlock-fill"></i> B·ªè ch·∫∑n</button>
                                    </div>
                                </div>
                                <div class="friend-item">
                                    <img src="https://randomuser.me/api/portraits/women/89.jpg" alt="·∫¢nh ng∆∞·ªùi b·ªã ch·∫∑n" class="friend-avatar"/>
                                    <div class="friend-info">
                                        <h3 class="friend-name">Tr·ªãnh VƒÉn F</h3>
                                    </div>
                                    <div class="friend-actions">
                                        <button class="friend-btn" data-action="unblock"><i class="bi bi-unlock-fill"></i> B·ªè ch·∫∑n</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5. Logout Section -->
                <section id="logout" class="menu-section" style="display: none;">
                    <h2>ƒêƒÉng xu·∫•t</h2>
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?</p>
                    <button id="confirm-logout">X√°c nh·∫≠n</button>
                </section>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="controller/api.js"></script>
<script src="service/websocket.js"></script>
<script src="service/ConversationService.js"></script>
<script src="service/messageService.js"></script>
<script src="controller/chat-list.js"></script>
<script src="controller/chat-message.js"></script>
<!-- Inline Script for UI Interactions -->
<script>
    document.getElementById("confirm-logout").addEventListener("click", function () {
        localStorage.clear();
        window.location.href = "auth.html";
    });

    document.addEventListener('DOMContentLoaded', () => {
        // Toggle menu dropdown
        const menuToggle = document.getElementById('menu-toggle');
        const sidebarMenu = document.getElementById('sidebar-menu');
        menuToggle.addEventListener('click', () => {
            sidebarMenu.style.display = sidebarMenu.style.display === 'block' ? 'none' : 'block';
        });

        const menuOverlay = document.getElementById('menu-content-overlay');
        const menuSections = document.querySelectorAll('.menu-section');

        // Handle sidebar menu click
        document.querySelectorAll('#sidebar-menu li').forEach(item => {
            item.addEventListener('click', function () {
                const sectionId = this.getAttribute('data-section');
                menuOverlay.style.display = 'flex';

                menuSections.forEach(sec => {
                    sec.style.display = 'none';
                });

                const targetSection = document.getElementById(sectionId);
                if(targetSection) {
                    targetSection.style.display = 'block';
                }

                sidebarMenu.style.display = 'none';
            });
        });

        // Close overlay menu
        document.getElementById('menu-close').addEventListener('click', () => {
            menuOverlay.style.display = 'none';
        });

        // (M·ªöI) Chuy·ªÉn t·ª´ Trang c√° nh√¢n sang m·ª•c Ch·ªânh s·ª≠a
        document.getElementById('edit-profile-btn').addEventListener('click', () => {
            menuSections.forEach(sec => sec.style.display = 'none');
            document.getElementById('security').style.display = 'block';

            // K√≠ch ho·∫°t tab ƒë·∫ßu ti√™n (Ch·ªânh s·ª≠a th√¥ng tin) b·∫±ng c√°ch gi·∫£ l·∫≠p m·ªôt click
            const editInfoTab = document.querySelector('.security-nav-item[data-target="security-edit-info"]');
            if(editInfoTab) {
                editInfoTab.click();
            }
        });

        // (M·ªöI) Logic chuy·ªÉn tab trong m·ª•c B·∫£o m·∫≠t
        const securityNavItems = document.querySelectorAll('.security-nav-item');
        const securityViews = document.querySelectorAll('.security-view');

        securityNavItems.forEach(item => {
            item.addEventListener('click', () => {
                securityNavItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                const targetId = item.getAttribute('data-target');
                securityViews.forEach(view => {
                    view.style.display = view.id === targetId ? 'block' : 'none';
                });
            });
        });

        // Logout confirmation
        document.getElementById('confirm-logout').addEventListener('click', () => {
            alert('B·∫°n ƒë√£ ƒëƒÉng xu·∫•t!');
            menuOverlay.style.display = 'none';
        });

        // Handle friend action buttons (v√≠ d·ª•)
        document.querySelectorAll('.friend-btn').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation(); // NgƒÉn s·ª± ki·ªán n·ªïi b·ªçt
                const action = this.getAttribute('data-action');
                const friendItem = this.closest('.friend-item');
                const friendName = friendItem ? friendItem.querySelector('.friend-name').textContent : 'ai ƒë√≥';
                alert(`Th·ª±c hi·ªán h√†nh ƒë·ªông '${action}' v·ªõi ${friendName}.`);
            });
        });



    });
</script>
</body>
</html>